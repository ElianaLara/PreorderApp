<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Place Your Order</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/preorder.css') }}">
</head>
<body>

<header class="top-bar">
  <a href="{{ url_for('main.home') }}" class="back">← Back</a>
  <h1>Place Your Order for {{ table.restaurant.name}}</h1>
  <p> {{ table.customer_name }} · {{ table.num_people }} · {{ table.preorders|length }} / {{ table.num_people }} ordered</p>
</header>

<main class="layout">

  <!-- MENU -->
  <section class="menu">
    <h2>Menu</h2>

    {% macro render_menu(level) %}
      <div class="{{ level.class }}">
        <div class="{{ level.header_class }}">
          <span>{{ level.name }}</span>
          <span class="toggle">+</span>
        </div>

        <div class="{{ level.items_class }}">
          {% if level.items is mapping %}
            {% for subname, subitems in level.items.items() %}
              {{ render_menu({
                'name': subname,
                'items': subitems,
                'class': 'subcategory',
                'header_class': 'subcategory-header',
                'items_class': 'items'
              }) }}
            {% endfor %}
          {% elif level.items is iterable %}
            {% for item in level.items %}
              <div class="item">
                <h4>{{ item }}</h4>
                <button>Add to Order</button>
              </div>
            {% endfor %}
          {% endif %}
        </div>
      </div>
    {% endmacro %}

    {% for category, subcategories in menu_items.items() %}
      {{ render_menu({
        'name': category,
        'items': subcategories,
        'class': 'category',
        'header_class': 'category-header',
        'items_class': 'items'
      }) }}
    {% endfor %}

  </section>

  <!-- ORDER PANEL -->
  <aside class="order">
    <label>Your Name</label>
    <input type="text" placeholder="Enter your name">

    <h3>Your Items</h3>
    <p class="empty">No items added yet</p>

    <label>Notes:</label>
    <input type="text" placeholder="Example: Gluten Free">

    <button class="submit">Add Pre-Order</button>
  </aside>

</main>

<script>
  // Toggle categories and subcategories
  document.querySelectorAll('.category-header, .subcategory-header').forEach(header => {
    header.addEventListener('click', () => {
      header.parentElement.classList.toggle('open');
    });
  });
</script>

</body>
</html>
